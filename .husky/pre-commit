#!/bin/bash
# Ensure nvm-installed node/pnpm is in PATH
export PATH="$HOME/.nvm/versions/node/v20.19.5/bin:$PATH"

# Skip if no staged changes in packages (docs, configs don't need checks)
if ! git diff --cached --name-only | grep -q "^packages/"; then
  echo "âœ… No package changes detected, skipping checks"
  exit 0
fi

echo "ðŸš€ Running pre-commit checks (Nx cached)..."

# Run lint and test in PARALLEL using Nx's built-in parallelization
# This uses Nx's cache - if files haven't changed, results are instant
pnpm nx affected -t lint,test \
  --parallel=3 \
  --output-style=stream-without-prefixes
