# Codecov Configuration for ofri-peretz/eslint monorepo
# https://docs.codecov.com/docs/codecov-yaml

coverage:
  precision: 2
  round: down
  range: '70...100'
  status:
    project:
      default:
        target: auto
        threshold: 5%
    patch:
      default:
        target: auto
        threshold: 5%

comment:
  layout: 'header, diff, flags, components'
  behavior: default
  require_changes: false

# ═══════════════════════════════════════════════════════════════════════════════
# TEST ANALYTICS (https://docs.codecov.com/docs/test-analytics)
# ═══════════════════════════════════════════════════════════════════════════════
# Tracks test run times, failure rates, and flaky tests
# JUnit XML reports are uploaded via codecov/test-results-action in CI

# ═══════════════════════════════════════════════════════════════════════════════
# COMPONENT MANAGEMENT FOR MONOREPO
# ═══════════════════════════════════════════════════════════════════════════════
# Each package gets its own component for separate coverage tracking

component_management:
  default_rules:
    statuses:
      - type: project
        target: auto
        branches:
          - '!main'
  individual_components:
    # ─────────────────────────────────────────────────────────────────────────
    # Security Plugins (Primary)
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: secure-coding
      name: 'eslint-plugin-secure-coding'
      paths:
        - packages/eslint-plugin-secure-coding/**
      statuses:
        - type: project
          target: 85%
        - type: patch
          target: 80%

    - component_id: crypto
      name: 'eslint-plugin-crypto'
      paths:
        - packages/eslint-plugin-crypto/**
      statuses:
        - type: project
          target: 85%
        - type: patch
          target: 80%

    - component_id: jwt
      name: 'eslint-plugin-jwt'
      paths:
        - packages/eslint-plugin-jwt/**
      statuses:
        - type: project
          target: 85%
        - type: patch
          target: 80%

    - component_id: pg
      name: 'eslint-plugin-pg'
      paths:
        - packages/eslint-plugin-pg/**
      statuses:
        - type: project
          target: 80%
        - type: patch
          target: 75%

    - component_id: mongodb-security
      name: 'eslint-plugin-mongodb-security'
      paths:
        - packages/eslint-plugin-mongodb-security/**
      statuses:
        - type: project
          target: 85%
        - type: patch
          target: 80%

    - component_id: node-security
      name: 'eslint-plugin-node-security'
      paths:
        - packages/eslint-plugin-node-security/**
      statuses:
        - type: project
          target: 85%
        - type: patch
          target: 80%

    # ─────────────────────────────────────────────────────────────────────────
    # Framework Security Plugins
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: express-security
      name: 'eslint-plugin-express-security'
      paths:
        - packages/eslint-plugin-express-security/**
      statuses:
        - type: project
          target: 80%

    - component_id: nestjs-security
      name: 'eslint-plugin-nestjs-security'
      paths:
        - packages/eslint-plugin-nestjs-security/**
      statuses:
        - type: project
          target: 80%

    - component_id: lambda-security
      name: 'eslint-plugin-lambda-security'
      paths:
        - packages/eslint-plugin-lambda-security/**
      statuses:
        - type: project
          target: 80%

    - component_id: browser-security
      name: 'eslint-plugin-browser-security'
      paths:
        - packages/eslint-plugin-browser-security/**
      statuses:
        - type: project
          target: 80%

    # ─────────────────────────────────────────────────────────────────────────
    # AI Security Plugins
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: vercel-ai-security
      name: 'eslint-plugin-vercel-ai-security'
      paths:
        - packages/eslint-plugin-vercel-ai-security/**
      statuses:
        - type: project
          target: 90%

    # ─────────────────────────────────────────────────────────────────────────
    # Governance & Quality Plugins
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: conventions
      name: 'eslint-plugin-conventions'
      paths:
        - packages/eslint-plugin-conventions/**
      statuses:
        - type: project
          target: 80%

    - component_id: maintainability
      name: 'eslint-plugin-maintainability'
      paths:
        - packages/eslint-plugin-maintainability/**
      statuses:
        - type: project
          target: 80%

    - component_id: modernization
      name: 'eslint-plugin-modernization'
      paths:
        - packages/eslint-plugin-modernization/**
      statuses:
        - type: project
          target: 80%

    - component_id: modularity
      name: 'eslint-plugin-modularity'
      paths:
        - packages/eslint-plugin-modularity/**
      statuses:
        - type: project
          target: 80%

    - component_id: operability
      name: 'eslint-plugin-operability'
      paths:
        - packages/eslint-plugin-operability/**
      statuses:
        - type: project
          target: 80%

    - component_id: reliability
      name: 'eslint-plugin-reliability'
      paths:
        - packages/eslint-plugin-reliability/**
      statuses:
        - type: project
          target: 80%

    # ─────────────────────────────────────────────────────────────────────────
    # Core Packages
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: eslint-devkit
      name: 'eslint-devkit'
      paths:
        - packages/eslint-devkit/**
      statuses:
        - type: project
          target: 70%

    # ─────────────────────────────────────────────────────────────────────────
    # Utility & Feature Plugins
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: import-next
      name: 'eslint-plugin-import-next'
      paths:
        - packages/eslint-plugin-import-next/**
      statuses:
        - type: project
          target: 75%

    - component_id: react-features
      name: 'eslint-plugin-react-features'
      paths:
        - packages/eslint-plugin-react-features/**

    - component_id: react-a11y
      name: 'eslint-plugin-react-a11y'
      paths:
        - packages/eslint-plugin-react-a11y/**

    # NOTE: cli is an infrastructure package without tests - excluded

# ═══════════════════════════════════════════════════════════════════════════════
# IGNORE PATHS
# ═══════════════════════════════════════════════════════════════════════════════
# Files that don't contain runtime logic or lack tests

ignore:
  - '**/*.test.ts'
  - '**/*.spec.ts'
  - '**/node_modules/**'
  - '**/dist/**'
  - '**/.nx/**'
  - '**/types/**'
  - '**/types/index.ts'
  - '**/coverage/**'
  - '**/test-results/**'
  - '**/*.config.ts'
  - '**/*.config.mts'
  - '**/vitest.global-setup.ts'
  # Infrastructure packages without tests
  - 'packages/cli/**'
  # Plugin entry points (configuration code, not tested)
  - 'packages/*/src/index.ts'
