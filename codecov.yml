# Codecov Configuration for ofri-peretz/eslint monorepo
# https://docs.codecov.com/docs/codecov-yaml

coverage:
  precision: 2
  round: down
  range: "70...100"
  status:
    project:
      default:
        target: auto
        threshold: 5%
    patch:
      default:
        target: auto
        threshold: 5%

comment:
  layout: "header, diff, flags, components"
  behavior: default
  require_changes: false

# ═══════════════════════════════════════════════════════════════════════════════
# TEST ANALYTICS (https://docs.codecov.com/docs/test-analytics)
# ═══════════════════════════════════════════════════════════════════════════════
# Tracks test run times, failure rates, and flaky tests
# JUnit XML reports are uploaded via codecov/test-results-action in CI

# ═══════════════════════════════════════════════════════════════════════════════
# COMPONENT MANAGEMENT FOR MONOREPO
# ═══════════════════════════════════════════════════════════════════════════════
# Each package gets its own component for separate coverage tracking

component_management:
  default_rules:
    statuses:
      - type: project
        target: auto
        branches:
          - "!main"
  individual_components:
    # ─────────────────────────────────────────────────────────────────────────
    # Security Plugins (Primary)
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: secure_coding
      name: "eslint-plugin-secure-coding"
      paths:
        - packages/eslint-plugin-secure-coding/**
      statuses:
        - type: project
          target: 85%
        - type: patch
          target: 80%

    - component_id: crypto
      name: "eslint-plugin-crypto"
      paths:
        - packages/eslint-plugin-crypto/**
      statuses:
        - type: project
          target: 85%
        - type: patch
          target: 80%

    - component_id: jwt
      name: "eslint-plugin-jwt"
      paths:
        - packages/eslint-plugin-jwt/**
      statuses:
        - type: project
          target: 85%
        - type: patch
          target: 80%

    - component_id: pg
      name: "eslint-plugin-pg"
      paths:
        - packages/eslint-plugin-pg/**
      statuses:
        - type: project
          target: 80%
        - type: patch
          target: 75%

    # ─────────────────────────────────────────────────────────────────────────
    # Framework Security Plugins
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: express_security
      name: "eslint-plugin-express-security"
      paths:
        - packages/eslint-plugin-express-security/**
      statuses:
        - type: project
          target: 80%

    - component_id: nestjs_security
      name: "eslint-plugin-nestjs-security"
      paths:
        - packages/eslint-plugin-nestjs-security/**
      statuses:
        - type: project
          target: 80%

    - component_id: lambda_security
      name: "eslint-plugin-lambda-security"
      paths:
        - packages/eslint-plugin-lambda-security/**
      statuses:
        - type: project
          target: 80%

    - component_id: browser_security
      name: "eslint-plugin-browser-security"
      paths:
        - packages/eslint-plugin-browser-security/**
      statuses:
        - type: project
          target: 80%

    # ─────────────────────────────────────────────────────────────────────────
    # AI Security Plugins
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: vercel_ai_security
      name: "eslint-plugin-vercel-ai-security"
      paths:
        - packages/eslint-plugin-vercel-ai-security/**
      statuses:
        - type: project
          target: 90%

    # ─────────────────────────────────────────────────────────────────────────
    # Core Packages
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: eslint_devkit
      name: "eslint-devkit"
      paths:
        - packages/eslint-devkit/**
      statuses:
        - type: project
          target: 70%

    # ─────────────────────────────────────────────────────────────────────────
    # Utility & Feature Plugins
    # ─────────────────────────────────────────────────────────────────────────
    - component_id: import_next
      name: "eslint-plugin-import-next"
      paths:
        - packages/eslint-plugin-import-next/**
      statuses:
        - type: project
          target: 75%

    - component_id: react_features
      name: "eslint-plugin-react-features"
      paths:
        - packages/eslint-plugin-react-features/**

    - component_id: react_a11y
      name: "eslint-plugin-react-a11y"
      paths:
        - packages/eslint-plugin-react-a11y/**

    - component_id: architecture
      name: "eslint-plugin-architecture"
      paths:
        - packages/eslint-plugin-architecture/**

    - component_id: quality
      name: "eslint-plugin-quality"
      paths:
        - packages/eslint-plugin-quality/**

    # NOTE: cli is an infrastructure package without tests - excluded

# ═══════════════════════════════════════════════════════════════════════════════
# IGNORE PATHS
# ═══════════════════════════════════════════════════════════════════════════════
# Files that don't contain runtime logic or lack tests

ignore:
  - "**/*.test.ts"
  - "**/*.spec.ts"
  - "**/node_modules/**"
  - "**/dist/**"
  - "**/.nx/**"
  - "**/types/**"
  - "**/types/index.ts"
  - "**/coverage/**"
  - "**/test-results/**"
  - "**/*.config.ts"
  - "**/*.config.mts"
  - "**/vitest.global-setup.ts"
  # Infrastructure packages without tests
  - "packages/cli/**"
  # Plugin entry points (configuration code, not tested)
  - "packages/*/src/index.ts"
